<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>*cute* and *pop* - Tag Display Demo</title>
  <style>
    * {
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
      margin: 0;
      font-family: "Heisei Mincho", "MS Mincho", "SimSun", serif;
      background: #fff;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 1rem;
    }

    .image-container {
      position: relative;
      width: 100%;
      max-width: 900px;
      margin: 0 auto 0.75rem;
      background: #f5f5f5;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 6px 30px rgba(0,0,0,.15);
      min-height: 300px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #randomImage {
      width: 100%;
      height: auto;
      max-height: 85vh;
      object-fit: contain;
      opacity: 1;
      transition: opacity 0.3s ease-in-out;
      display: block;
    }

    /* Mobile optimizations */
    @media (max-width: 768px) {
      .image-container {
        max-width: 95vw;
        min-height: 250px;
        margin-bottom: 0.5rem;
      }

      #randomImage {
        max-height: 70vh;
      }
    }

    /* Tablet/medium screens */
    @media (min-width: 769px) and (max-width: 1200px) {
      .image-container {
        max-width: 700px;
      }

      #randomImage {
        max-height: 80vh;
      }
    }

    /* Large desktop screens */
    @media (min-width: 1201px) {
      .image-container {
        max-width: 1000px;
      }

      #randomImage {
        max-height: 90vh;
      }
    }

    /* Tag Overlay - Bottom positioned */
    .tag-overlay {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(to top, rgba(0,0,0,0.75), transparent);
      padding: 2rem 1rem 1rem;
      opacity: 0;
      transform: translateY(10px);
      transition: opacity 0.3s ease, transform 0.3s ease;
      pointer-events: none;
    }

    .image-container:hover .tag-overlay,
    .image-container:focus-within .tag-overlay {
      opacity: 1;
      transform: translateY(0);
      pointer-events: auto;
    }

    .tag-preview {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
      align-items: center;
    }

    .tag {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      background: rgba(255, 255, 255, 0.9);
      color: #333;
      border-radius: 20px;
      font-size: 0.85rem;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      white-space: nowrap;
      backdrop-filter: blur(4px);
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .tag[data-category="content"] { border-left: 3px solid #ff6b9d; }
    .tag[data-category="character"] { border-left: 3px solid #4ecdc4; }
    .tag[data-category="creator"] { border-left: 3px solid #95e1d3; }
    .tag[data-category="source"] { border-left: 3px solid #ffa07a; }

    .expand-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      padding: 0.25rem 0.75rem;
      background: rgba(255, 255, 255, 0.95);
      color: #333;
      border: none;
      border-radius: 20px;
      font-size: 0.85rem;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      cursor: pointer;
      backdrop-filter: blur(4px);
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      transition: background 0.2s ease, transform 0.1s ease;
    }

    .expand-btn:hover {
      background: rgba(255, 255, 255, 1);
      transform: scale(1.05);
    }

    .expand-btn:focus {
      outline: 2px solid #4ecdc4;
      outline-offset: 2px;
    }

    .expand-btn::after {
      content: '▼';
      font-size: 0.7rem;
      transition: transform 0.3s ease;
    }

    .expand-btn.expanded::after {
      transform: rotate(180deg);
    }

    /* Expanded Metadata View */
    .metadata-panel {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: #fff;
      border-top: 1px solid #ddd;
      box-shadow: 0 -4px 20px rgba(0,0,0,0.15);
      max-height: 60vh;
      overflow-y: auto;
      padding: 1.5rem;
      transform: translateY(100%);
      transition: transform 0.3s ease-in-out;
      z-index: 1000;
    }

    .metadata-panel.open {
      transform: translateY(0);
    }

    .metadata-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .metadata-header h2 {
      margin: 0;
      font-size: 1.25rem;
      font-weight: 500;
      color: #333;
    }

    .close-btn {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: #666;
      padding: 0.25rem;
      line-height: 1;
      transition: color 0.2s ease;
    }

    .close-btn:hover {
      color: #000;
    }

    .close-btn:focus {
      outline: 2px solid #4ecdc4;
      outline-offset: 2px;
    }

    .metadata-section {
      margin-bottom: 1.5rem;
    }

    .metadata-section h3 {
      font-size: 1rem;
      font-weight: 500;
      color: #666;
      margin: 0 0 0.75rem 0;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    .tag-category {
      margin-bottom: 1rem;
    }

    .tag-category-name {
      font-size: 0.9rem;
      font-weight: 600;
      color: #555;
      margin-bottom: 0.5rem;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    .tag-list {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .metadata-info {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      font-size: 0.9rem;
    }

    .metadata-item {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .metadata-label {
      font-weight: 600;
      color: #666;
    }

    .metadata-value {
      color: #333;
    }

    .metadata-value a {
      color: #4ecdc4;
      text-decoration: none;
    }

    .metadata-value a:hover {
      text-decoration: underline;
    }

    /* Artist Credit Display */
    .artist-credit {
      text-align: center;
      margin: 1rem auto 0.5rem;
      max-width: 600px;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    .artist-credit-label {
      font-size: 0.75rem;
      color: #888;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      margin-bottom: 0.25rem;
    }

    .artist-credit-name {
      font-size: 1.1rem;
      font-weight: 600;
      color: #333;
      margin-bottom: 0.25rem;
    }

    .artist-credit-name a {
      color: #333;
      text-decoration: none;
      transition: color 0.2s ease;
    }

    .artist-credit-name a:hover {
      color: #4ecdc4;
    }

    .artist-credit-social {
      font-size: 0.9rem;
      color: #666;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.35rem;
    }

    .artist-credit-social a {
      color: #4ecdc4;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      transition: color 0.2s ease;
    }

    .artist-credit-social a:hover {
      color: #3ab5ac;
      text-decoration: underline;
    }

    .artist-credit-social::before {
      content: '→';
      font-size: 0.9rem;
      color: #999;
    }

    .artist-credit-help {
      font-size: 0.85rem;
      color: #888;
      font-style: italic;
    }

    .artist-credit-help a {
      color: #4ecdc4;
      text-decoration: none;
      font-style: normal;
    }

    .artist-credit-help a:hover {
      text-decoration: underline;
    }

    .artist-unknown {
      color: #888;
      font-style: italic;
    }

    .disclaimer {
      font-size: 0.85rem;
      color: #888;
      text-align: center;
      max-width: 600px;
      line-height: 1.4;
      margin-top: 0.75rem;
      opacity: 0.8;
    }

    .footer-link {
      font-size: 0.75rem;
      color: #999;
      text-align: center;
      margin-top: 0.5rem;
    }

    .footer-link a {
      color: #999;
      text-decoration: none;
      transition: color 0.2s ease;
    }

    .footer-link a:hover {
      color: #4ecdc4;
    }

    /* Accessibility - High Contrast Mode */
    @media (prefers-contrast: high) {
      .tag, .expand-btn {
        background: #fff;
        border: 2px solid #000;
      }
    }

    /* Accessibility - Reduced Motion */
    @media (prefers-reduced-motion: reduce) {
      *,
      *::before,
      *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
      }
    }

    /* Responsive adjustments */
    @media (max-width: 600px) {
      .metadata-panel {
        max-height: 70vh;
        padding: 1rem;
      }

      .tag-preview {
        gap: 0.35rem;
      }

      .tag, .expand-btn {
        font-size: 0.75rem;
        padding: 0.2rem 0.6rem;
      }
    }

    /* Overlay backdrop when panel is open */
    .backdrop {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.3);
      z-index: 999;
    }

    .backdrop.visible {
      display: block;
    }

    .demo-notice {
      position: fixed;
      top: 1rem;
      right: 1rem;
      background: #4ecdc4;
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      font-size: 0.85rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      z-index: 9999;
    }
  </style>
</head>
<body>
  <div class="demo-notice">Demo Mode - Using Mock Data</div>

  <div class="image-container" role="img" aria-label="Random cute image">
    <img id="randomImage" alt="Cute kawaii illustration" loading="eager"
         src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 500 500'%3E%3Crect fill='%23ffb3d9' width='500' height='500'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='Arial' font-size='48' fill='%23fff'%3E🌸 DEMO 🌸%3C/text%3E%3C/svg%3E" />

    <div class="tag-overlay" id="tagOverlay" aria-label="Image tags">
      <div class="tag-preview" id="tagPreview" role="navigation" aria-label="Quick tags"></div>
      <button
        class="expand-btn"
        id="expandBtn"
        aria-expanded="false"
        aria-controls="metadataPanel"
      >View all</button>
    </div>
  </div>

  <div class="backdrop" id="backdrop" aria-hidden="true"></div>

  <aside
    class="metadata-panel"
    id="metadataPanel"
    role="complementary"
    aria-label="Image metadata"
  >
    <div class="metadata-header">
      <h2>Image Details</h2>
      <button class="close-btn" id="closeBtn" aria-label="Close metadata panel">×</button>
    </div>
    <div id="metadataContent"></div>
  </aside>

  <div class="artist-credit" id="artistCredit">
    <div class="artist-credit-label">Artist</div>
    <div class="artist-credit-name" id="artistName"></div>
    <div class="artist-credit-social" id="artistSocial"></div>
  </div>

  <div class="disclaimer">
    This is a demo of the tag display system. Hover over the image to see tags appear!
  </div>

  <div class="footer-link">
    <a href="https://github.com/araragi-lacking-branding/poptocute-images" target="_blank" rel="noopener noreferrer">GitHub</a>
  </div>

  <script>
    // Mock data for demo
    const mockData = {
      id: 1,
      filename: 'images/cute-demo.png',
      alt_text: 'Cute kawaii illustration',
      file_size: 245760,
      width: 800,
      height: 800,
      mime_type: 'image/png',
      created_at: '2025-10-30 12:00:00',
      credit_name: 'Demo Artist',
      credit_url: 'https://example.com/artist',
      credit_social_handle: 'demoartist',
      credit_platform: 'twitter',
      credit_license: 'CC BY-SA 4.0',
      tags: [
        { name: 'cute', display_name: 'Cute', category: 'content' },
        { name: 'kawaii', display_name: 'Kawaii', category: 'content' },
        { name: 'pastel', display_name: 'Pastel', category: 'content' },
        { name: 'cat', display_name: 'Cat', category: 'content' },
        { name: 'pixel-art', display_name: 'Pixel Art', category: 'content' },
        { name: 'hello-kitty', display_name: 'Hello Kitty', category: 'character' },
        { name: 'pikachu', display_name: 'Pikachu', category: 'character' },
        { name: 'sanrio', display_name: 'Sanrio', category: 'creator' },
        { name: 'studio-ghibli', display_name: 'Studio Ghibli', category: 'creator' },
        { name: 'pokemon', display_name: 'Pokemon', category: 'source' },
        { name: 'animal-crossing', display_name: 'Animal Crossing', category: 'source' }
      ]
    };

    // HTML escape utility for security
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Format file size
    function formatFileSize(bytes) {
      if (!bytes) return 'Unknown';
      if (bytes < 1024) return bytes + ' B';
      if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
      return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
    }

    // Group tags by category
    function groupTagsByCategory(tags) {
      const grouped = {};
      tags.forEach(tag => {
        if (!grouped[tag.category]) {
          grouped[tag.category] = [];
        }
        grouped[tag.category].push(tag);
      });
      return grouped;
    }

    // Create tag element
    function createTagElement(tag) {
      const tagEl = document.createElement('span');
      tagEl.className = 'tag';
      tagEl.textContent = tag.display_name || tag.name;
      tagEl.setAttribute('data-category', tag.category);
      tagEl.setAttribute('data-tag-id', tag.name);
      return tagEl;
    }

    // Build metadata panel content
    function buildMetadataPanel(data) {
      const content = [];

      // Tags section
      if (data.tags && data.tags.length > 0) {
        const grouped = groupTagsByCategory(data.tags);
        const categoryOrder = ['content', 'character', 'creator', 'source'];

        content.push('<div class="metadata-section"><h3>Tags</h3>');
        categoryOrder.forEach(category => {
          if (grouped[category]) {
            content.push(`<div class="tag-category">
              <div class="tag-category-name">${escapeHtml(category.charAt(0).toUpperCase() + category.slice(1))}</div>
              <div class="tag-list">`);
            grouped[category].forEach(tag => {
              content.push(`<span class="tag" data-category="${escapeHtml(category)}" data-tag-id="${escapeHtml(tag.name)}">${escapeHtml(tag.display_name || tag.name)}</span>`);
            });
            content.push('</div></div>');
          }
        });
        content.push('</div>');
      }

      // Image info section
      content.push('<div class="metadata-section"><h3>Image Information</h3>');
      content.push('<div class="metadata-info">');

      if (data.width && data.height) {
        content.push(`<div class="metadata-item">
          <span class="metadata-label">Dimensions</span>
          <span class="metadata-value">${data.width} × ${data.height}px</span>
        </div>`);
      }

      if (data.file_size) {
        content.push(`<div class="metadata-item">
          <span class="metadata-label">File Size</span>
          <span class="metadata-value">${formatFileSize(data.file_size)}</span>
        </div>`);
      }

      if (data.mime_type) {
        content.push(`<div class="metadata-item">
          <span class="metadata-label">Format</span>
          <span class="metadata-value">${escapeHtml(data.mime_type.split('/')[1].toUpperCase())}</span>
        </div>`);
      }

      if (data.credit_name) {
        content.push(`<div class="metadata-item">
          <span class="metadata-label">Credit</span>
          <span class="metadata-value">${
            data.credit_url
              ? `<a href="${escapeHtml(data.credit_url)}" target="_blank" rel="noopener noreferrer">${escapeHtml(data.credit_name)}</a>`
              : escapeHtml(data.credit_name)
          }</span>
        </div>`);
      }

      if (data.credit_license) {
        content.push(`<div class="metadata-item">
          <span class="metadata-label">License</span>
          <span class="metadata-value">${escapeHtml(data.credit_license)}</span>
        </div>`);
      }

      content.push('</div></div>');

      return content.join('');
    }

    // Load demo data
    function loadDemoData() {
      const imageContainer = document.querySelector('.image-container');
      const tagPreview = document.getElementById('tagPreview');
      const expandBtn = document.getElementById('expandBtn');
      const metadataContent = document.getElementById('metadataContent');

      // Set container aspect ratio based on image dimensions
      if (mockData.width && mockData.height) {
        const aspectRatio = mockData.width / mockData.height;
        imageContainer.style.aspectRatio = aspectRatio.toString();
      }

      // Build tag preview (show top 5 tags)
      tagPreview.innerHTML = '';
      if (mockData.tags && mockData.tags.length > 0) {
        const previewTags = mockData.tags.slice(0, 5);
        previewTags.forEach(tag => {
          tagPreview.appendChild(createTagElement(tag));
        });

        expandBtn.style.display = 'inline-flex';
      }

      // Display artist credit - always visible for transparency
      const artistCredit = document.getElementById('artistCredit');
      const artistName = document.getElementById('artistName');
      const artistSocial = document.getElementById('artistSocial');

      // Determine if artist is unknown
      const isUnknown = !mockData.credit_name || mockData.credit_name === 'Unknown Artist';

      if (isUnknown) {
        // Show unknown artist with help option
        artistName.innerHTML = `<span class="artist-unknown">Unknown Artist</span>`;

        // Build email body - short and simple for universal compatibility
        const emailBody = encodeURIComponent(
          `Thank you for helping properly credit art for ID: ${mockData.filename}. Please let us know your request (attribution, removal, or anything else), and we'll take action ASAP. If you'd like to help us provide as much credit as possible, knowing the artist name, social, link to their art page, and anything similar, we're happy to update. We appreciate you immensely.`
        );

        artistSocial.innerHTML = `<span class="artist-credit-help">Know who created this? <a href="mailto:lambda@cutetopop.com?subject=Artist Attribution - ${encodeURIComponent(mockData.filename)}&body=${emailBody}">Help us attribute</a></span>`;
      } else {
        // Build artist name (with or without link)
        if (mockData.credit_url) {
          artistName.innerHTML = `<a href="${escapeHtml(mockData.credit_url)}" target="_blank" rel="noopener noreferrer">${escapeHtml(mockData.credit_name)}</a>`;
        } else {
          artistName.textContent = mockData.credit_name;
        }

        // Build social media link - only if available
        if (mockData.credit_social_handle && mockData.credit_platform) {
          const platformDisplay = mockData.credit_platform.charAt(0).toUpperCase() + mockData.credit_platform.slice(1);
          artistSocial.innerHTML = `<a href="${escapeHtml(mockData.credit_url || '#')}" target="_blank" rel="noopener noreferrer">@${escapeHtml(mockData.credit_social_handle)} on ${escapeHtml(platformDisplay)}</a>`;
        } else if (mockData.credit_url) {
          artistSocial.innerHTML = `<a href="${escapeHtml(mockData.credit_url)}" target="_blank" rel="noopener noreferrer">View Profile</a>`;
        } else {
          artistSocial.textContent = '';
        }
      }

      // Build full metadata panel
      metadataContent.innerHTML = buildMetadataPanel(mockData);
    }

    // Toggle metadata panel
    const expandBtn = document.getElementById('expandBtn');
    const closeBtn = document.getElementById('closeBtn');
    const metadataPanel = document.getElementById('metadataPanel');
    const backdrop = document.getElementById('backdrop');

    function openPanel() {
      metadataPanel.classList.add('open');
      backdrop.classList.add('visible');
      expandBtn.classList.add('expanded');
      expandBtn.setAttribute('aria-expanded', 'true');
      backdrop.setAttribute('aria-hidden', 'false');
    }

    function closePanel() {
      metadataPanel.classList.remove('open');
      backdrop.classList.remove('visible');
      expandBtn.classList.remove('expanded');
      expandBtn.setAttribute('aria-expanded', 'false');
      backdrop.setAttribute('aria-hidden', 'true');
    }

    expandBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      if (metadataPanel.classList.contains('open')) {
        closePanel();
      } else {
        openPanel();
      }
    });

    closeBtn.addEventListener('click', closePanel);
    backdrop.addEventListener('click', closePanel);

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && metadataPanel.classList.contains('open')) {
        closePanel();
      }
    });

    // Initialize
    loadDemoData();
  </script>
</body>
</html>
